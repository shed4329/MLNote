# Project: 网络攻击流量异常检测

## 项目介绍

本项目基于 KDD CUP 1999 数据集，实现了一个基于单变量高斯分布的网络异常检测模型。通过对网络流量特征的分析，模型能够识别出异常的网络连接，可用于网络入侵检测等场景。

## 数据集说明
使用的数据集是 KDD CUP 1999 的 10% 抽样数据（`kddcup.data_10_percent_corrected`），包含 494,021 条网络连接记录，每条记录包含 41 个特征和 1 个标签（标记连接是否正常）。

### 主要标签分布（前 10 类）：

- smurf.：280,790 条
- neptune.：107,201 条
- normal.：97,278 条
- back.：2,203 条
- satan.：1,589 条
- 其他类别样本数较少

## 项目结构
```text
.
├── code/                   # 代码目录
│   ├── feature_engineering_continous.py    # 特征工程与可视化脚本
│   ├── model.py                            # 异常检测模型实现
│   ├── read_data.py                        # 数据读取工具
│   └── report.txt                          # 模型评估报告
├── dataset/                # 数据集目录
│   ├── kddcup.data_10_percent_corrected        # 原始数据集
│   ├── kddcup.data_10_percent_corrected.csv    # 处理后的数据集
│   └── kddcup.names                            # 数据集特征说明
├── feature_engineering/                        # 特征工程目录
└── readme.md               # 自述文件
```

## 核心功能
### 数据处理
1. 读取并解析 KDD CUP 1999 数据集
2. 过滤样本数过少的类别（少于 5 个样本）
3. 按 5:1:4 比例划分训练集、验证集和测试集
### 特征工程
1. 对连续特征进行变换处理：
   - count和srv_count：应用log(x+10)变换
   - src_bytes：应用log(x+1)变换
   - dst_bytes：应用log(x+1)变换
2. 特征分布可视化（高斯分布拟合）
### 异常检测模型
1. 基于单变量高斯分布构建异常检测模型
   - 计算每个特征的均值和方差作为分布参数
   - 通过联合对数概率判断样本是否异常
2. 模型评估
   - 使用验证集确定异常判断阈值
   - 计算精确率、召回率和 F1 分数评估模型性能
   - 生成混淆矩阵分析检测结果

## 模型性能
### 在测试集上的评估结果：

精确率：0.9955
召回率：0.9819
F1 分数：0.9887

### 混淆矩阵：

|      | 预测正常        | 预测异常      |
|------|-------------|-----------|
| 实际正常 | 38208       | 703       |
| 实际异常 | 2867        | 155827    |

## 使用方法
- 准备数据集，放入dataset目录
- 特征分布可视化：
```bash
python feature_engineering_continous.py
```
- 运行模型训练与评估：
```bash
python model.py
```

- 查看生成的report.txt获取详细结果

## 实现细节
### 特征选择
模型使用了 4 个关键特征进行异常检测：
- `count`：当前连接同一主机的连接数
- `dst_bytes`：目标主机接收的字节数
- `src_bytes`：源主机发送的字节数
- `srv_count`：当前连接同一服务的连接数
### 异常判断逻辑
- 计算样本在 4 个特征上的联合对数概率
- 使用验证集正常样本的 5% 分位数作为阈值
- 低于阈值的样本被判定为异常
### 数据划分策略
- 采用分层抽样确保各标签在数据集划分中比例一致
- 对小样本类别进行过滤，保证评估的可靠性

该项目展示了基于统计方法的异常检测思路，对于网络安全监控具有一定的参考价值。

## 项目不足之处
尽管本项目在 KDD CUP 1999 数据集上取得了较好的检测性能，但仍存在以下不足： 
### 特征选择局限性
仅使用了 4 个连续特征（`count`、`dst_bytes`、`src_bytes`、`srv_count`）进行建模，忽略了数据集中其他 37 个特征（如协议类型、服务类型等离散特征），可能丢失重要的异常检测信号。
未考虑特征间的关联性，单变量高斯分布假设特征独立，难以捕捉特征间的协同模式。
### 模型方法单一
仅采用基于高斯分布的统计方法，对非高斯分布特征的拟合效果有限，可能导致部分异常模式漏检。
缺乏与其他算法（如孤立森林、One-Class SVM 等）的对比验证，难以确定当前方法的最优性。
### 数据处理局限性
- 对特征的变换方式（如log(x+10)）是固定的，未针对不同特征的分布特性进行自适应调整，可能影响分布拟合精度。
- 仅过滤了样本数少于 5 的类别，未处理极端值和噪声数据对模型的干扰。
### 阈值确定方式简单
- 直接采用验证集正常样本的 5% 分位数作为阈值，未考虑不同应用场景下对精确率和召回率的不同需求（如高安全性场景可能需要更高的召回率）。
- 阈值未经过交叉验证优化，可能存在过拟合验证集的风险。
### 数据集时效性问题
KDD CUP 1999 数据集发布时间较早（1999 年），其中包含的网络攻击类型和网络环境与当前实际场景差异较大，模型在现代网络环境中的适用性有待验证。
数据集中部分类别样本数量极不均衡（如smurf.和neptune.占比过高），可能导致模型对小众攻击类型的检测能力不足。
### 功能完整性不足
缺乏实时检测功能，无法直接应用于动态网络环境。
没有提供可视化界面，对异常检测结果的分析和展示不够直观。